# Chaos Scenarios - çœŸå¯¦ç”¨æˆ¶ã€Œäº‚æ“ä½œã€æ¸¬è©¦è¨ˆåŠƒ

## ç›®çš„
æ¸¬è©¦ç³»çµ±åœ¨é¢å°ã€Œéžé æœŸã€éžç·šæ€§ã€æ··äº‚ã€çš„ç”¨æˆ¶è¼¸å…¥æ™‚çš„ç©©å®šæ€§ã€‚

---

## å ´æ™¯åˆ†é¡ž

### 1. ä¸­é€”æ”¹ä¸»æ„ (Change of Mind)

#### 1.1 æ”¹æ—¥æœŸ
```
ç”¨æˆ¶ï¼š"åŽ»è‹—å ´"
åŠ©æ‰‹ï¼š"ä»€éº¼æ™‚å€™å‡ºç™¼ï¼Ÿ"
ç”¨æˆ¶ï¼š"3æœˆ20æ—¥"
åŠ©æ‰‹ï¼š"æ‰“ç®—å¾…å¹¾å¤©ï¼Ÿ"
ç”¨æˆ¶ï¼š"ç­‰ç­‰ï¼Œæ”¹æˆ3æœˆ22æ—¥"
```
**é æœŸè¡Œç‚º**ï¼š
- âœ… ç³»çµ±æ‡‰è©²èƒ½è­˜åˆ¥é€™æ˜¯ã€Œä¿®æ­£æ—¥æœŸã€
- âœ… æ›´æ–° startDate ç‚º 3/22
- âœ… ä¿æŒåœ¨ AWAITING_DURATION ç‹€æ…‹
- âœ… å›žæ‡‰ï¼š"å¥½çš„ï¼Œå·²æ›´æ–°ç‚º 3/22 å‡ºç™¼ã€‚æ‰“ç®—å¾…å¹¾å¤©å‘¢ï¼Ÿ"

#### 1.2 æ”¹å¤©æ•¸
```
ç”¨æˆ¶ï¼š"3æœˆ20æ—¥åŽ»5å¤©"
åŠ©æ‰‹ï¼š"å¥½çš„ï¼..." (é€²å…¥ CONFIRMING_TRIP)
ç”¨æˆ¶ï¼š"å…¶å¯¦æˆ‘åªåŽ»3å¤©å°±å¥½"
```
**é æœŸè¡Œç‚º**ï¼š
- âœ… æ›´æ–° duration ç‚º 3
- âœ… é‡æ–°è¨ˆç®— endDate
- âœ… å›žåˆ° CONFIRMING_TRIPï¼Œé¡¯ç¤ºæ›´æ–°å¾Œçš„è³‡è¨Š

#### 1.3 æ”¹é›ªå ´
```
ç”¨æˆ¶ï¼š"åŽ»è‹—å ´ 3/20-25"
åŠ©æ‰‹ï¼š"å¥½çš„ï¼..." (å·²å¡«å¥½æ‰€æœ‰è³‡æ–™)
ç”¨æˆ¶ï¼š"æ”¹åŽ»é‡Žæ¾¤"
```
**é æœŸè¡Œç‚º** (ç¾åœ¨)ï¼š
- âœ… æç¤ºç”¨æˆ¶é€™å°‡é‡æ–°é–‹å§‹
- âœ… çµ¦äºˆç¢ºèªé¸é …

**é æœŸè¡Œç‚º** (æœªä¾†)ï¼š
- âœ… ä¿ç•™æ—¥æœŸ/å¤©æ•¸ï¼Œåªæ›´æ–°é›ªå ´
- âœ… å›žåˆ° CONFIRMING_TRIP é‡æ–°ç¢ºèª

---

### 2. å–æ¶ˆå’Œé‡ä¾† (Cancel & Restart)

#### 2.1 ä¸­é€”å–æ¶ˆ
```
ç”¨æˆ¶ï¼š"åŽ»è‹—å ´"
åŠ©æ‰‹ï¼š"ä»€éº¼æ™‚å€™å‡ºç™¼ï¼Ÿ"
ç”¨æˆ¶ï¼š"ç®—äº†ï¼Œä¸è¦äº†"
```
**é æœŸè¡Œç‚º**ï¼š
- âœ… è­˜åˆ¥å–æ¶ˆæ„åœ–
- âœ… é‡ç½®è¡¨å–®
- âœ… å›žåˆ° MAIN_MENU
- âœ… å›žæ‡‰ï¼š"å¥½çš„ï¼Œå·²å–æ¶ˆã€‚é‚„æœ‰ä»€éº¼æˆ‘å¯ä»¥å¹«å¿™çš„å—Žï¼Ÿ"

#### 2.2 ç¢ºèªéšŽæ®µå–æ¶ˆ
```
ç”¨æˆ¶ï¼š"3/20 åŽ»è‹—å ´ 5å¤©"
åŠ©æ‰‹ï¼š"ç¢ºèªå»ºç«‹å—Žï¼Ÿ..."
ç”¨æˆ¶ï¼š"ä¸è¦ï¼Œæˆ‘è¦é‡ä¾†"
```
**é æœŸè¡Œç‚º**ï¼š
- âœ… é‡ç½®è¡¨å–®
- âœ… å›žåˆ°åˆå§‹ç‹€æ…‹
- âœ… å›žæ‡‰ï¼š"å¥½çš„ï¼Œè®“æˆ‘å€‘é‡æ–°é–‹å§‹ã€‚ä½ æƒ³åŽ»å“ªå€‹é›ªå ´ï¼Ÿ"

---

### 3. è©±é¡Œåˆ†å‰ (Topic Branching)

#### 3.1 è©¢å•åˆ—è¡¨
```
ç”¨æˆ¶ï¼š"åŽ»è‹—å ´"
åŠ©æ‰‹ï¼š"ä»€éº¼æ™‚å€™å‡ºç™¼ï¼Ÿ"
ç”¨æˆ¶ï¼š"ç­‰ç­‰ï¼Œæœ‰å“ªäº›é›ªå ´å¯ä»¥é¸ï¼Ÿ"
```
**é æœŸè¡Œç‚º**ï¼š
- âœ… ä¿å­˜ç•¶å‰é€²åº¦ (resort: è‹—å ´)
- âœ… é¡¯ç¤ºé›ªå ´åˆ—è¡¨
- âœ… æç¤ºï¼š"çœ‹å®Œå¯ä»¥ç¹¼çºŒå‰›æ‰çš„è¡Œç¨‹è¦åŠƒ"

#### 3.2 CONFIRMING_TRIP æ™‚åˆ†å‰
```
ç”¨æˆ¶ï¼š"3/20 è‹—å ´ 5å¤©"
åŠ©æ‰‹ï¼š"ç¢ºèªå»ºç«‹å—Žï¼Ÿ..."
ç”¨æˆ¶ï¼š"é †ä¾¿æŽ¨è–¦ä¸€ä¸‹è£å‚™"
```
**é æœŸè¡Œç‚º** (ç¾åœ¨)ï¼š
- âš ï¸ å¯èƒ½æœƒèª¤åˆ¤ç‚ºã€Œä¸ç¢ºèªã€
- âš ï¸ éœ€è¦æ”¹é€²

**é æœŸè¡Œç‚º** (æœªä¾†)ï¼š
- âœ… è­˜åˆ¥ç‚ºã€Œé¡å¤–è«‹æ±‚ã€
- âœ… æš«å­˜è¡Œç¨‹ç‹€æ…‹
- âœ… è™•ç†è£å‚™æŽ¨è–¦
- âœ… å®Œæˆå¾Œå›žåˆ°ç¢ºèªæµç¨‹

---

### 4. ç„¡æ•ˆè¼¸å…¥ (Invalid Input)

#### 4.1 äº‚æ‰“ä¸€é€š
```
ç”¨æˆ¶ï¼š"asdfghjkl"
åŠ©æ‰‹ï¼šï¼Ÿ
```
**é æœŸè¡Œç‚º**ï¼š
- âœ… å„ªé›…é™ç´š
- âœ… å›žæ‡‰ï¼š"æŠ±æ­‰ï¼Œæˆ‘æ²’æœ‰ç†è§£ã€‚ä½ å¯ä»¥å‘Šè¨´æˆ‘æƒ³åŽ»å“ªå€‹é›ªå ´å—Žï¼Ÿ"
- âœ… æä¾›ç¯„ä¾‹

#### 4.2 è¡¨æƒ…ç¬¦è™Ÿ
```
ç”¨æˆ¶ï¼š"ðŸ˜ŠðŸ˜ŠðŸ˜Š"
åŠ©æ‰‹ï¼šï¼Ÿ
```
**é æœŸè¡Œç‚º**ï¼š
- âœ… ä¸è¦ crash
- âœ… å›žæ‡‰é¡žä¼¼ç„¡æ•ˆè¼¸å…¥

#### 4.3 èªžè¨€æ··ç”¨
```
ç”¨æˆ¶ï¼š"æˆ‘æƒ³åŽ» Niseko 3æœˆ20æ—¥"
åŠ©æ‰‹ï¼šï¼Ÿ
```
**é æœŸè¡Œç‚º**ï¼š
- âœ… èƒ½è­˜åˆ¥è‹±æ–‡é›ªå ´å
- âœ… èƒ½è­˜åˆ¥ä¸­æ–‡æ—¥æœŸ
- âœ… æ­£å¸¸è™•ç†

---

### 5. é‚Šç•Œæƒ…æ³ (Edge Cases)

#### 5.1 æ™‚é–“é‚Šç•Œ
```
æ™‚é–“ï¼š11:59 PM
ç”¨æˆ¶ï¼š"æ˜Žå¤©åŽ»è‹—å ´"
```
**é æœŸè¡Œç‚º**ï¼š
- âœ… æ­£ç¢ºè¨ˆç®—ã€Œæ˜Žå¤©ã€ï¼ˆè€ƒæ…®æ™‚å€ï¼‰
- âœ… ä¸è¦å‡ºç¾æ—¥æœŸéŒ¯ä½

#### 5.2 è·¨å¹´åˆ¤æ–·
```
ç•¶å‰ï¼š12æœˆ28æ—¥
ç”¨æˆ¶ï¼š"1æœˆ5æ—¥åŽ»è‹—å ´"
```
**é æœŸè¡Œç‚º**ï¼š
- âœ… åˆ¤æ–·ç‚ºã€Œæ˜Žå¹´ã€1æœˆ5æ—¥
- âœ… ä¸æ˜¯ã€Œä»Šå¹´å·²éŽã€çš„1æœˆ5æ—¥

#### 5.3 é›ªå­£çµæŸ
```
ç•¶å‰ï¼š5æœˆ1æ—¥
ç”¨æˆ¶ï¼š"åŽ»è‹—å ´"
åŠ©æ‰‹ï¼šï¼Ÿ
```
**é æœŸè¡Œç‚º** (é¸é … A)ï¼š
- âš ï¸ è­¦å‘Šï¼š"é›ªå­£é€šå¸¸åœ¨4æœˆçµæŸï¼Œä»è¦ç¹¼çºŒå—Žï¼Ÿ"

**é æœŸè¡Œç‚º** (é¸é … B)ï¼š
- âœ… å…è¨±å»ºç«‹ï¼Œä¸åšé™åˆ¶ï¼ˆç”¨æˆ¶å¯èƒ½æœ‰ç‰¹æ®ŠåŽŸå› ï¼‰

#### 5.4 æ—¥æœŸåœ¨éŽåŽ»
```
ç•¶å‰ï¼š3æœˆ20æ—¥
ç”¨æˆ¶ï¼š"3æœˆ15æ—¥åŽ»è‹—å ´"
```
**é æœŸè¡Œç‚º**ï¼š
- âœ… æ‹’çµ•ä¸¦æç¤ºï¼š"3æœˆ15æ—¥å·²ç¶“éŽäº†ï¼Œè«‹é¸æ“‡æœªä¾†çš„æ—¥æœŸ"

---

### 6. å¤šè¼ªæ··äº‚å°è©± (Multi-turn Chaos)

#### 6.1 å®Œå…¨ä¸æŒ‰é †åº
```
Round 1: "5å¤©"
Round 2: "è‹—å ´"
Round 3: "3æœˆ20æ—¥"
Round 4: "å…¬é–‹æ‰¾2å€‹äºº"
```
**é æœŸè¡Œç‚º**ï¼š
- âœ… èƒ½å¤ é€æ­¥æ”¶é›†è³‡è¨Š
- âœ… æœ€çµ‚èƒ½å®Œæ•´å»ºç«‹è¡Œç¨‹
- âœ… ä¸æœƒå› ç‚ºé †åºäº‚è€Œ crash

#### 6.2 é‡è¤‡è¼¸å…¥
```
Round 1: "è‹—å ´"
Round 2: "è‹—å ´"
Round 3: "è‹—å ´"
```
**é æœŸè¡Œç‚º**ï¼š
- âœ… è­˜åˆ¥ç‚ºé‡è¤‡ï¼ˆä¸æ˜¯è®Šæ›´ï¼‰
- âœ… å›žæ‡‰ï¼š"å·²ç¶“è¨˜éŒ„äº†è‹—å ´ã€‚ä»€éº¼æ™‚å€™å‡ºç™¼å‘¢ï¼Ÿ"

#### 6.3 çŸ›ç›¾è¼¸å…¥
```
Round 1: "3æœˆ20-25æ—¥"  (duration = 5å¤©)
Round 2: "åŽ»3å¤©"       (duration = 3å¤©)
```
**é æœŸè¡Œç‚º**ï¼š
- âœ… æ˜Žç¢ºå¤©æ•¸å„ªå…ˆï¼ˆcurrent behavior âœ…ï¼‰
- âœ… é‡æ–°è¨ˆç®— endDate
- âœ… æç¤ºï¼š"å·²æ›´æ–°ç‚º 3 å¤©ï¼ˆ3/20-22ï¼‰"

---

## æ¸¬è©¦å„ªå…ˆç´š

### P0 - å¿…é ˆæ¸¬è©¦ï¼ˆæœƒå°Žè‡´ crash æˆ–è³‡æ–™éŒ¯èª¤ï¼‰
- [ ] æ”¹æ—¥æœŸã€æ”¹å¤©æ•¸
- [ ] ä¸­é€”å–æ¶ˆ
- [ ] äº‚æ‰“ä¸€é€šï¼ˆä¸crashï¼‰
- [ ] æ—¥æœŸåœ¨éŽåŽ»ï¼ˆæ‹’çµ•ï¼‰
- [ ] è·¨å¹´åˆ¤æ–·

### P1 - æ‡‰è©²æ¸¬è©¦ï¼ˆUX é«”é©—å•é¡Œï¼‰
- [ ] æ”¹é›ªå ´ï¼ˆç¾åœ¨æœƒ resetï¼‰
- [ ] è©±é¡Œåˆ†å‰ï¼ˆé›ªå ´åˆ—è¡¨ï¼‰
- [ ] è¡¨æƒ…ç¬¦è™Ÿ
- [ ] èªžè¨€æ··ç”¨
- [ ] é‡è¤‡è¼¸å…¥

### P2 - å¯ä»¥æ¸¬è©¦ï¼ˆé‚Šç·£æ¡ˆä¾‹ï¼‰
- [ ] æ™‚é–“é‚Šç•Œï¼ˆ11:59 PMï¼‰
- [ ] é›ªå­£çµæŸè­¦å‘Š
- [ ] CONFIRMING_TRIP æ™‚åˆ†å‰è©±é¡Œ
- [ ] å®Œå…¨ä¸æŒ‰é †åºè¼¸å…¥

---

## æ¸¬è©¦å¯¦ç¾è¨ˆåŠƒ

### éšŽæ®µ 7.1: è£œå…… Unit Tests
åœ¨ `tripFormLogic.test.ts` ä¸­æ–°å¢žï¼š
```typescript
describe('Chaos Scenarios - æ”¹ä¸»æ„', () => {
  it('æ‡‰è©²èƒ½ä¸­é€”æ”¹æ—¥æœŸ', async () => { ... });
  it('æ‡‰è©²èƒ½ä¸­é€”æ”¹å¤©æ•¸', async () => { ... });
  it('æ‡‰è©²èƒ½è­˜åˆ¥å–æ¶ˆæ„åœ–', async () => { ... });
});

describe('Chaos Scenarios - ç„¡æ•ˆè¼¸å…¥', () => {
  it('æ‡‰è©²å„ªé›…è™•ç†äº‚ç¢¼', async () => { ... });
  it('æ‡‰è©²è™•ç†è¡¨æƒ…ç¬¦è™Ÿ', async () => { ... });
  it('æ‡‰è©²æ‹’çµ•éŽåŽ»çš„æ—¥æœŸ', async () => { ... });
});
```

### éšŽæ®µ 7.2: E2E Tests
ä½¿ç”¨ Playwright/Cypressï¼š
```typescript
test('çœŸå¯¦ç”¨æˆ¶æµç¨‹ï¼šä¸­é€”æ”¹ä¸»æ„', async ({ page }) => {
  // æ‰“é–‹å°è©±æ¡†
  // è¼¸å…¥ï¼š"åŽ»è‹—å ´"
  // è¼¸å…¥ï¼š"3/20"
  // è¼¸å…¥ï¼š"ç­‰ç­‰ï¼Œæ”¹æˆ 3/22"
  // é©—è­‰ï¼šæ—¥æœŸå·²æ›´æ–°ï¼Œç‹€æ…‹æ­£ç¢º
});
```

### éšŽæ®µ 7.3: Monkey Testing
éš¨æ©Ÿç”Ÿæˆè¼¸å…¥ï¼Œæ¸¬è©¦ç©©å®šæ€§ï¼š
```typescript
test('Monkey test: 1000 random inputs', async () => {
  for (let i = 0; i < 1000; i++) {
    const randomInput = generateRandomInput();
    const result = await processUserInput(randomInput, context);

    // ä¸æ‡‰è©² crash
    expect(result).toBeDefined();

    // ç‹€æ…‹æ‡‰è©²åˆæ³•
    expect(VALID_STATES).toContain(result.updatedContext.state);
  }
});
```

---

## æˆåŠŸæ¨™æº–

ä¸€å€‹ç©©å®šçš„ conversationEngine æ‡‰è©²ï¼š
- âœ… é¢å°ä»»ä½•è¼¸å…¥éƒ½ä¸ crash
- âœ… é¢å°çŸ›ç›¾è¼¸å…¥èƒ½å„ªé›…é™ç´š
- âœ… é¢å°æ”¹ä¸»æ„èƒ½æ­£ç¢ºæ›´æ–°
- âœ… é¢å°å–æ¶ˆèƒ½æ­£ç¢ºé‡ç½®
- âœ… é¢å°åˆ†å‰è©±é¡Œèƒ½ä¿å­˜é€²åº¦
- âœ… é¢å°ç„¡æ•ˆè¼¸å…¥èƒ½æä¾›å¹«åŠ©

---

**ä¸‹ä¸€æ­¥**ï¼š
1. æŒ‘é¸ P0 å ´æ™¯ï¼Œè£œå……åˆ°ç¾æœ‰æ¸¬è©¦
2. è¨­è¨ˆ E2E æ¸¬è©¦æ¡†æž¶
3. é€æ­¥å¯¦ç¾ P1ã€P2 å ´æ™¯

**é è¨ˆæ™‚é–“**ï¼š
- P0 æ¸¬è©¦ï¼š1-2 å¤©
- E2E æ¡†æž¶ï¼š2-3 å¤©
- P1/P2 æ¸¬è©¦ï¼šè¦–æƒ…æ³è€Œå®š

---

**æœ€å¾Œæ›´æ–°**: 2025-11-16
