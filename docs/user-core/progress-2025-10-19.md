# User Core - 2025-10-19 進度紀錄

## 已完成
- 主檔 API（建立/更新/停用/合併）全面整合 change feed，`X-Actor-Id` 帶入審計，change feed payload 包含 diff。
- 行為事件：`schema_url`、排序參數與核心 schema registry 落地，並新增 SLA 計時。
- 推播偏好：集中管理、更新事件觸發 webhook，審計欄位完善。
- `specs/shared/event_catalog.yaml` 建立，`event_schema_registry.py` 與單元測試同步驗證。
- OpenAPI 契約與 change feed 契約可透過 pytest 自動驗證。
- 全部 pytest（unit / integration / contract）皆為綠燈。

## 目前能力
- 穩定提供滑雪者主檔與合併流程，兼顧 legacy ID / locale profile。
- 標準化行為事件寫入與查詢，同時支援自訂事件與核心治理。
- 推播偏好變更即時發布，消費者可依 diff 調整排程。
- 文件：`spec.md`、`CHANGELOG.md`、`MIGRATION_PLAN.md`、事件型錄與契約皆已最新。

## 未完成 / 待辦
- UC-T303 `legacy_mapping_service` 模組化（目前邏輯在 service 中）。
- UC-T307、UC-T506、UC-T507：資料匯入與種子腳本仍待撰寫。
- UC-T207、UC-T208：補齊模型與 OpenAPI 合約層面的 unit/contract 測試。
- 角色正規化（user_roles）與 locale hash 遷移尚未啟動。
- Phase 6：Makefile / setup script、監控、負載測試等精緻化項目。

## 快速開始
1. `python3 -m pytest` 確認所有測試綠燈。
2. 更新事件 schema 時，先修改 `specs/shared/event_catalog.yaml`，再跑 `tests/unit/user_core/test_event_catalog_sync.py`。
3. 變更 API 後執行 `tests/contract/user_core/test_openapi_contract.py`；若變更為預期，使用 `platform/user_core` 的 `app.openapi()` 重新輸出契約。
