# SkiDIY Platform

SkiDIY 是一個全面性的滑雪運動愛好者平台，採用微服務架構，旨在幫助滑雪愛好者找到滑雪夥伴、記錄滑雪足跡、管理滑雪裝備，以及提升滑雪知識和技能。

## 架構概覽

本平台由多個相互關聯的服務組成：

### 後端服務
- **user-core**：使用者身份和核心資料服務，作為所有使用者資料的單一真實來源
- **resort-services**：雪場資訊服務，管理 43 個日本滑雪場的詳細資料
- **snowbuddy-matching**：智慧雪伴匹配引擎，幫助使用者找到最適合的滑雪夥伴

### 前端應用
- **ski-platform**：React + TypeScript Web 應用，提供完整的用戶界面和互動體驗

## 功能特性

### 🎿 核心功能
- **智能行程規劃**
  - AI 對話助手：自然語言創建行程（如「新增苗場2月3到7日」）
  - 支援 43 個日本知名雪場識別（別名系統 + 優先級匹配）
  - 行程管理：建立、查看、編輯、刪除
  - 雪季管理：自動雪季創建和統計
  - 行程狀態追蹤：規劃中、已確認、已完成、已取消

- **滑雪足跡記錄**
  - 雪道記錄和統計
  - 成就系統：解鎖各類滑雪成就
  - 個人滑雪數據可視化

- **社交互動**
  - 活動動態 Feed
  - 雪伴公佈欄：瀏覽所有公開行程，申請加入滑雪夥伴
  - 雪伴申請管理：接受/拒絕申請，實時通知系統
  - 智慧雪伴匹配：基於技能和地點偏好的配對算法
  - 雪伴邀請和接受流程

- **雪場資訊**
  - 43 個日本雪場資料庫
  - 雪場詳情查詢
  - 雪況統計和設施資訊

### 🤖 AI 對話助手特性
- **自然語言理解**
  - 支援多種表達方式（如「去二世谷」、「二世谷 12月20日 5天」）
  - 智能缺失資訊補全（多輪對話）
  - 意圖識別：建立行程、查看行程、刪除行程、閒聊

- **雪場識別系統**
  - 別名配置（如「二世谷」、「Niseko」、「新雪谷」）
  - 優先級匹配（熱門雪場優先）
  - 模糊匹配和建議（Levenshtein 距離）

- **對話狀態管理**
  - 連續行程創建支援
  - 上下文保持和累積資料
  - 錯誤處理和友好提示

### 🤝 雪伴公佈欄特性
- **行程瀏覽和篩選**
  - 瀏覽所有公開行程
  - 按時間篩選：本月、下月、未來 N 個月
  - 按雪場篩選：43 個雪場智能過濾
  - 按狀態篩選：可申請、申請中、已加入、已額滿、已拒絕

- **雪伴申請系統**
  - 一鍵申請加入公開行程
  - 申請狀態實時追蹤（pending、accepted、declined）
  - 取消申請功能（僅 pending 狀態）
  - 行程主人接受/拒絕申請

- **實時通知系統**
  - 導航欄通知鈴鐺：顯示待處理申請數量紅色徽章
  - 自動更新機制：每 30 秒自動刷新
  - 通知下拉選單：直接在下拉選單中接受/拒絕申請
  - 點擊通知可跳轉至行程詳情

### 🔐 技術特性
- **統一認證系統**：所有服務使用 user-core 的集中式認證
- 使用者身份管理與個人資料
- 行為事件記錄與分析
- 安全的 API 端點保護（Bearer Token / X-User-Id）

## 技術架構

### 後端
- **微服務架構**：採用 Python + FastAPI 開發
- **統一認證**：共享認證模組，環境感知的安全機制
- **容器化**：使用 Docker 和 Docker Compose 進行部署
- **資料庫**：PostgreSQL 用於使用者資料，Redis 用於快取和非同步任務
- **API 標準**：開放 API 規範，提供完整的 REST API
- **測試驅動開發**：95+ 測試涵蓋所有核心功能

### 前端
- **框架**：React 18 + TypeScript
- **狀態管理**：Redux Toolkit
- **路由**：React Router v6
- **樣式**：Tailwind CSS
- **構建工具**：Vite
- **API 通信**：Axios

## 快速開始

### 前置需求

- Docker
- Docker Compose
- Node.js 18+ (僅前端開發)

### 部署步驟

#### 後端服務

1. 克隆此儲存庫：
   ```bash
   git clone https://github.com/James3014/snow-project.git
   cd snow-project
   ```

2. 啟動服務：
   ```bash
   docker-compose up --build
   ```

3. 服務將在以下端點運行：
   - **User Core API**: http://localhost:8001
   - **Resort API**: http://localhost:8000
   - **Snowbuddy Matching API**: http://localhost:8002
   - **API 文件**: http://localhost:8000/docs (Resort API)

#### 前端應用

1. 進入前端目錄：
   ```bash
   cd platform/frontend/ski-platform
   ```

2. 安裝依賴：
   ```bash
   npm install
   ```

3. 啟動開發伺服器：
   ```bash
   npm run dev
   ```

4. 應用將在 http://localhost:5173 運行

5. 構建生產版本：
   ```bash
   npm run build
   ```

## 服務說明

### User Core Service (`user-core`)
- 處理所有使用者身份和個人資料
- **提供認證 API** (`/auth/login`, `/auth/validate`)
- 管理使用者行為事件記錄
- 提供其他服務所需的使用者資料

### Resort Services API (`resort-api`)
- 提供雪場資訊查詢（公開端點）
- 管理 43 個日本滑雪場的靜態資料
- **受保護**：滑雪足跡記錄需要認證
- 支援分頁查詢（limit/offset）

### Snowbuddy Matching Service (`snowbuddy-matching`)
- **全部需要認證**：所有匹配和配對端點
- 實現非同步雪伴搜尋功能
- 執行基於技能、地點和時間偏好的匹配算法
- 處理雪伴邀請和接受流程

### Frontend Platform (`ski-platform`)
- React + TypeScript Web 應用
- AI 對話助手界面
- 行程規劃和管理介面
- 滑雪足跡記錄介面
- 成就系統和社交動態
- 響應式設計，支援桌面和移動端

## 開發進度

### 後端服務
- ✅ **user-core**: 功能完整 (100%) - 含認證 API 和完整測試套件
- ✅ **resort-services**: 功能完整 (100%) - API 完整實作含認證
- ✅ **snowbuddy-matching**: 功能完整 (100%) - 智能匹配引擎含認證
- ✅ **統一認證架構**: 完整 (100%) - 所有服務使用集中式認證

### 前端應用
- ✅ **使用者認證**: 登入、註冊、個人資料管理 (100%)
- ✅ **行程規劃系統**: 完整 CRUD + AI 助手 (100%)
  - ✅ AI 對話助手
  - ✅ 雪場識別（43 個雪場）
  - ✅ 自然語言行程創建
  - ✅ 行程編輯和刪除
  - ✅ 雪季自動管理
- ✅ **滑雪足跡記錄**: 雪道記錄和統計 (100%)
- ✅ **成就系統**: 成就解鎖和展示 (100%)
- ✅ **社交動態**: Activity Feed (100%)
- ✅ **雪伴系統**: 雪伴公佈欄、申請管理、實時通知 (100%)
- ✅ **雪場資訊**: 43 個雪場詳情查詢 (100%)

### 未來規劃
- 🟡 **coach-scheduling**: 教練預約系統 - 規劃完成，待實作
- 🔵 **gear-ops**: 裝備管理系統 - 規劃階段
- 🔵 **knowledge-engagement**: 知識社群系統 - 規劃階段

## 最新更新

### 2025-11-15 - 雪伴功能優化 & 繁體中文完善
- ✅ **雪伴申請系統優化**
  - 修復取消申請 400 錯誤：已拒絕的申請不再顯示「移除記錄」按鈕
  - 修復通知鈴鐺功能：紅色數字徽章自動顯示待處理申請數量
  - 添加自動更新機制：每 30 秒自動刷新通知數量
  - 首次載入時自動獲取待處理申請
- ✅ **繁體中文完善**
  - 全面檢查並修復系統中的簡體字
  - 修復範圍：使用者界面、組件註釋、AI 功能相關檔案
  - 確保所有文字統一使用繁體中文

### 2025-11-11 - AI 助手增強 & 刪除功能
- ✅ **修復雪場識別 Bug**: 解決 API 分頁問題，現在可識別所有 43 個雪場
- ✅ **AI 對話刪除功能**: 新增 DELETE_TRIP 意圖識別和處理
  - 支援「刪除苗場行程」、「刪除第1個行程」等多種表達
  - 智能匹配待刪除行程（按雪場、日期、編號）
  - 確認對話框防止誤刪
- ✅ **行程詳情刪除按鈕**: 在行程詳情頁面添加實體刪除按鈕
  - 紅色警告樣式的刪除按鈕
  - 模態確認對話框
  - 刪除中載入動畫
  - 刪除成功自動返回
- ✅ **對話狀態修復**: 修復行程建立後無法繼續操作的問題

### 2025-11-05 - 統一認證系統
- ✅ **🔐 統一認證架構**: 完整的認證系統跨所有服務
  - User-core 認證 API (`/auth/login`, `/auth/validate`)
  - 共享認證模組 (`shared/auth.py`)
  - 環境感知安全機制（開發/生產模式）
  - Bearer Token 和 X-User-Id 支援
- ✅ **95+ 測試**: 完整的單元、契約、整合、認證測試
- ✅ **遷移工具**: user-core legacy data migration script
- ✅ **Makefile**: 開發便利工具
- ✅ **完整文檔**: 所有服務都有 spec, plan, tasks + 認證指南

### 📊 測試覆蓋率
- user-core: 65 tests ✅
- resort-services: 9 tests (含 4 個認證測試) ✅
- snowbuddy-matching: 14 tests (含 6 個認證測試) ✅
- **後端總計**: 95+ tests 全部通過 ✅
- ski-platform (前端): 21+ 測試套件（AI 助手核心功能）✅

### 📚 文檔
- [實作總結](./IMPLEMENTATION_SUMMARY.md) - 完整的實作細節
- [認證架構指南](./docs/AUTHENTICATION.md) - 統一認證說明
- [AI 對話助手文檔](./platform/frontend/ski-platform/src/features/ai/README.md) - AI 功能說明（如果存在）

## 資料庫支援的雪場

系統目前支援 43 個日本知名滑雪場，涵蓋：

### 熱門地區
- **北海道**: 二世谷、留壽都、富良野、Tomamu、手稻、Kiroro、Sahoro 等
- **長野**: 白馬、志賀高原、野澤溫泉、輕井澤、白樺湖等
- **新潟**: 苗場、神樂、妙高赤倉、GALA 湯澤等
- **其他**: 猪苗代、安比高原、藏王等

AI 助手支援多種雪場名稱變體（中文、日文、英文），並能智能識別用戶意圖。

## 貢獻

歡迎提交 Issues 和 Pull Requests 來改善此專案。

### 開發指南
1. Fork 此專案
2. 創建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交變更 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 開啟 Pull Request

## 授權

此專案採用 MIT 授權。
