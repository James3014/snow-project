# 🎯 多後端整合新前端服務 + Dify

**優先級**: P3  
**預估時間**: 3-4 週  
**ROI**: ⭐⭐⭐⭐

---

## 概述

基於 SnowTrace 現有的微服務架構，設計 5 個創新的前端服務，每個服務整合 2-3 個後端，並由 Dify AI 提供智能決策層。

---

## 1️⃣ Trip Prep Lab（AI 行前教練）

### 整合服務
- resort-services（雪場資訊）
- 單板教學（學習紀錄）
- user-core（用戶歷史）

### 核心概念
```
出發前，一頁幫你把「要去哪＋會滑到什麼＋該練什麼」都準備好
```

### 原方案 vs Dify 增強

#### 原方案（純資料整合）
```
resort-services: 二世谷有粉雪、樹林、陡坡
單板教學: 你完成了 15 堂初級課程
user-core: 你去過 3 個雪場

→ 前端顯示：推薦課程 lesson-45, lesson-67（規則匹配）
```

#### + Dify 後（智能分析）
```
Dify Agent 分析：
├── 輸入：行程（二世谷 4 天）+ 用戶歷史 + 213 堂課程
├── RAG 檢索：粉雪相關課程
├── LLM 分析：
│   「你去過的雪場都是壓雪道，二世谷粉雪多，
│    建議先練『速度控制』和『浮板技巧』。
│    第一天先在壓雪道熱身，第二天再挑戰粉雪區。」
└── 輸出：
    ├── 行前必練：lesson-45（速度控制）、lesson-67（浮板入門）
    ├── 現場建議：Day 1 藍道熱身 → Day 2 粉雪初體驗
    └── 裝備提醒：粉雪板建議寬度 > 260mm

→ 不只推薦課程，還給出「為什麼」和「怎麼安排」
```

### 使用場景
```
用戶：「我想加強後刃控制」
↓
Dify 分析：
├── 從單板教學讀取：用戶後刃評分 2.5/5（弱項）
├── 從 user-core 讀取：去過的雪場都是短道
├── 從 resort-services 搜尋：有長藍道的雪場
↓
推薦：
「建議去志賀高原（有 5km 長藍道，適合練後刃）
 行程安排：
 - Day 1: 短道熱身 + 複習 lesson-03
 - Day 2-3: 長道練習，專注後刃控制
 - Day 4: 驗收成果」
```

### Dify Workflow 設計（完整版）

```yaml
名稱: AI 行前教練

輸入變數:
  - trip_id: 行程 ID
  - user_id: 用戶 ID

節點流程:
  1. [數據聚合節點]
     名稱: 收集用戶和行程資料
     操作:
       - HTTP 請求 1: GET resort-services/trips/{trip_id}
         返回: 雪場名稱、天數、雪況類型、地形特色、雪道分布
       
       - HTTP 請求 2: GET user-core/users/{user_id}/history
         返回: 去過的雪場、滑行天數、程度
       
       - HTTP 請求 3: GET 單板教學/api/practice-logs?user_id={user_id}
         返回: 完成的課程、練習評分、搜尋關鍵字
  
  2. [知識庫檢索節點]
     名稱: 搜尋相關課程
     知識庫: 單板教學 213 堂課程
     查詢: "{{resort.snow_conditions}} {{resort.terrain_features}} 相關課程"
     Top K: 20
     相似度閾值: 0.7
     Rerank: 啟用
  
  3. [LLM 分析節點]
     名稱: 生成行前建議
     模型: Claude 3.5 Sonnet
     Temperature: 0.7
     Max Tokens: 2000
     
     Prompt: |
       你是 CASI 認證教練，分析用戶的行程並給出專業建議。
       
       ## 行程資訊
       雪場：{{resort.name}}
       天數：{{trip.days}}
       雪況：{{resort.snow_conditions}}
       地形：{{resort.terrain_features}}
       雪道分布：綠道 {{resort.green_runs}}%、藍道 {{resort.blue_runs}}%、黑道 {{resort.black_runs}}%
       
       ## 用戶背景
       程度：{{user.level}}
       去過的雪場：{{user.visited_resorts}}
       完成的課程：{{user.completed_lessons}}
       最近練習評分：{{user.recent_ratings}}
       搜尋過的問題：{{user.search_keywords}}
       
       ## 相關課程（RAG 檢索結果）
       {{#rag_results}}
       
       請提供完整的行前準備建議，輸出 JSON 格式：
       
       {
         "summary": "一句話總結（50 字內）",
         "must_practice": [
           {
             "lesson_id": "lesson-45",
             "title": "速度控制",
             "priority": 1,
             "reason": "為什麼要練這個",
             "estimated_time": "30分鐘"
           }
         ],
         "daily_plan": [
           {
             "day": 1,
             "focus": "壓雪道熱身",
             "activities": ["藍道練習", "複習基礎動作"],
             "lessons_to_review": ["lesson-03"],
             "tips": "第一天不要急著挑戰粉雪"
           }
         ],
         "gear_checklist": {
           "board": "建議使用寬板（>260mm）",
           "maintenance": ["檢查邊刃", "打蠟"],
           "optional": ["護目鏡"]
         },
         "safety_notes": [
           "粉雪區域注意樹井",
           "能見度低時降低速度"
         ],
         "personalized_tips": "根據搜尋歷史給出針對性建議"
       }
  
  4. [條件分支節點]
     名稱: 特殊情況處理
     條件:
       - IF 用戶是新手 AND 雪場是進階 → 添加額外警告
       - IF 用戶去過類似雪場 → 簡化建議
       - IF 雪況特殊（粉雪/冰面）→ 強調裝備
  
  5. [代碼節點]
     名稱: 格式化輸出
     代碼: |
       import json
       
       # 驗證 JSON 格式
       result = json.loads(llm_output)
       
       # 添加時間戳
       result['generated_at'] = datetime.now().isoformat()
       result['trip_id'] = trip_id
       result['user_id'] = user_id
       
       return {'recommendations': json.dumps(result)}

輸出變數:
  - recommendations: 完整建議（JSON 字串）
```

### 前端完整實作

```tsx
// ski-platform/src/features/trip-prep/TripPrepLab.tsx
'use client'

import { useState, useEffect } from 'react'
import { callDifyWorkflow } from '@/lib/dify'
import { LessonCard } from '@/components/LessonCard'
import { LoadingState } from '@/components/ui/Loading'

interface TripPrepLabProps {
  tripId: string
}

export default function TripPrepLab({ tripId }: TripPrepLabProps) {
  const [loading, setLoading] = useState(true)
  const [recommendations, setRecommendations] = useState<any>(null)
  const [error, setError] = useState<string | null>(null)
  
  useEffect(() => {
    loadRecommendations()
  }, [tripId])
  
  async function loadRecommendations() {
    try {
      setLoading(true)
      setError(null)
      
      // 呼叫 Dify Workflow
      const result = await callDifyWorkflow('trip-prep-lab', {
        trip_id: tripId,
        user_id: userId
      })
      
      setRecommendations(JSON.parse(result.data.outputs.recommendations))
    } catch (err) {
      setError('無法載入建議，請稍後再試')
      console.error(err)
    } finally {
      setLoading(false)
    }
  }
  
  if (loading) return <LoadingState message="AI 教練分析中..." />
  if (error) return <ErrorState message={error} onRetry={loadRecommendations} />
  if (!recommendations) return null
  
  return (
    <div className="max-w-4xl mx-auto p-6 space-y-8">
      <h1 className="text-3xl font-bold">AI 行前教練</h1>
      
      {/* AI 總結 */}
      <section className="bg-gradient-to-r from-amber-500/20 to-orange-500/20 p-6 rounded-lg border border-amber-500/30">
        <div className="flex items-center gap-3 mb-4">
          <span className="text-4xl">🤖</span>
          <h2 className="text-xl font-bold">AI 教練建議</h2>
        </div>
        <p className="text-lg leading-relaxed">{recommendations.summary}</p>
      </section>
      
      {/* 行前必練 */}
      <section>
        <h3 className="text-xl font-bold mb-4 flex items-center gap-2">
          <span>📚</span>
          <span>行前必練（3 堂課）</span>
        </h3>
        <div className="space-y-4">
          {recommendations.must_practice.map((lesson: any, i: number) => (
            <div key={lesson.lesson_id} className="bg-zinc-800 p-5 rounded-lg hover:bg-zinc-750 transition">
              <div className="flex items-start gap-4">
                <div className="flex-shrink-0 w-10 h-10 rounded-full bg-gradient-to-r from-amber-500 to-orange-500 flex items-center justify-center font-bold text-lg">
                  {i + 1}
                </div>
                <div className="flex-1">
                  <h4 className="font-bold text-lg mb-2">{lesson.title}</h4>
                  <p className="text-zinc-400 mb-3">{lesson.reason}</p>
                  <div className="flex items-center gap-4 text-sm">
                    <span className="text-zinc-500">⏱️ {lesson.estimated_time}</span>
                    <a 
                      href={`/lesson/${lesson.lesson_id}`}
                      className="text-amber-500 hover:underline font-medium"
                    >
                      查看課程 →
                    </a>
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>
      </section>
      
      {/* 現場滑行建議 */}
      <section>
        <h3 className="text-xl font-bold mb-4 flex items-center gap-2">
          <span>🎿</span>
          <span>現場滑行建議</span>
        </h3>
        <div className="space-y-4">
          {recommendations.daily_plan.map((day: any, i: number) => (
            <div key={i} className="bg-zinc-800 p-5 rounded-lg">
              <div className="flex items-center gap-3 mb-4">
                <span className="text-2xl font-bold text-amber-500">Day {day.day}</span>
                <span className="text-zinc-600">·</span>
                <span className="font-bold text-lg">{day.focus}</span>
              </div>
              
              <div className="space-y-3">
                <div>
                  <div className="text-sm text-zinc-400 mb-2">活動安排：</div>
                  <ul className="list-disc list-inside space-y-1 text-zinc-300">
                    {day.activities.map((activity: string, j: number) => (
                      <li key={j}>{activity}</li>
                    ))}
                  </ul>
                </div>
                
                {day.lessons_to_review && day.lessons_to_review.length > 0 && (
                  <div>
                    <span className="text-sm text-zinc-400">複習課程：</span>
                    {day.lessons_to_review.map((lessonId: string, j: number) => (
                      <a 
                        key={j}
                        href={`/lesson/${lessonId}`}
                        className="ml-2 text-amber-500 hover:underline text-sm"
                      >
                        {lessonId}
                      </a>
                    ))}
                  </div>
                )}
                
                <div className="mt-3 p-3 bg-zinc-900 rounded-lg">
                  <span className="text-amber-500">💡</span>
                  <span className="ml-2 text-sm text-zinc-400">{day.tips}</span>
                </div>
              </div>
            </div>
          ))}
        </div>
      </section>
      
      {/* 裝備檢查清單 */}
      <section>
        <h3 className="text-xl font-bold mb-4 flex items-center gap-2">
          <span>🎒</span>
          <span>裝備檢查清單</span>
        </h3>
        <div className="bg-zinc-800 p-5 rounded-lg space-y-4">
          <div>
            <div className="text-sm text-zinc-400 mb-2 font-medium">雪板建議</div>
            <p className="text-zinc-200">{recommendations.gear_checklist.board}</p>
          </div>
          
          <div>
            <div className="text-sm text-zinc-400 mb-2 font-medium">保養項目</div>
            <ul className="list-disc list-inside space-y-1 text-zinc-300">
              {recommendations.gear_checklist.maintenance.map((item: string, i: number) => (
                <li key={i}>{item}</li>
              ))}
            </ul>
          </div>
          
          {recommendations.gear_checklist.optional && recommendations.gear_checklist.optional.length > 0 && (
            <div>
              <div className="text-sm text-zinc-400 mb-2 font-medium">建議攜帶</div>
              <ul className="list-disc list-inside space-y-1 text-zinc-300">
                {recommendations.gear_checklist.optional.map((item: string, i: number) => (
                  <li key={i}>{item}</li>
                ))}
              </ul>
            </div>
          )}
        </div>
      </section>
      
      {/* 安全注意事項 */}
      <section>
        <h3 className="text-xl font-bold mb-4 flex items-center gap-2">
          <span>⚠️</span>
          <span>安全注意事項</span>
        </h3>
        <div className="bg-red-900/20 border-2 border-red-700 p-5 rounded-lg">
          <ul className="space-y-3">
            {recommendations.safety_notes.map((note: string, i: number) => (
              <li key={i} className="flex items-start gap-3">
                <span className="text-red-500 text-xl flex-shrink-0">⚠️</span>
                <span className="text-zinc-200">{note}</span>
              </li>
            ))}
          </ul>
        </div>
      </section>
      
      {/* 個人化建議 */}
      {recommendations.personalized_tips && (
        <section>
          <h3 className="text-xl font-bold mb-4 flex items-center gap-2">
            <span>💡</span>
            <span>給你的特別建議</span>
          </h3>
          <div className="bg-gradient-to-r from-blue-900/20 to-purple-900/20 border-2 border-blue-700 p-5 rounded-lg">
            <p className="text-zinc-200 leading-relaxed">{recommendations.personalized_tips}</p>
          </div>
        </section>
      )}
      
      {/* 操作按鈕 */}
      <div className="flex gap-4 pt-4">
        <button 
          onClick={() => addToCalendar()}
          className="flex-1 px-6 py-4 bg-gradient-to-r from-amber-500 to-orange-500 rounded-lg font-bold text-lg hover:shadow-lg transition"
        >
          加入行事曆
        </button>
        <button 
          onClick={() => shareRecommendations()}
          className="px-6 py-4 bg-zinc-700 rounded-lg font-medium hover:bg-zinc-600 transition"
        >
          分享
        </button>
        <button 
          onClick={loadRecommendations}
          className="px-6 py-4 bg-zinc-700 rounded-lg font-medium hover:bg-zinc-600 transition"
        >
          重新生成
        </button>
      </div>
    </div>
  )
}
```

### API 封裝

```typescript
// ski-platform/src/lib/dify.ts
export async function generateTripPrepRecommendations(tripId: string, userId: string) {
  const response = await fetch(`${DIFY_API_URL}/v1/workflows/run`, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${DIFY_API_KEY}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      inputs: {
        trip_id: tripId,
        user_id: userId
      },
      response_mode: 'blocking',
      user: userId
    })
  })
  
  if (!response.ok) {
    throw new Error('Failed to generate recommendations')
  }
  
  const data = await response.json()
  return JSON.parse(data.data.outputs.recommendations)
}
```

### 價值提升對比

| 項目 | 無 Dify（規則引擎） | + Dify（AI 引擎） | 提升 |
|------|-------------------|------------------|------|
| **推薦深度** | 課程列表 | 完整學習計畫 + 每日安排 | ⭐⭐⭐⭐⭐ |
| **個人化** | 基於程度匹配 | 理解用戶困擾和歷史 | ⭐⭐⭐⭐⭐ |
| **可行動性** | 「看這些課程」 | 「Day 1 做什麼、Day 2 做什麼」 | ⭐⭐⭐⭐⭐ |
| **安全性** | 無 | 雪場特定安全提醒 | ⭐⭐⭐⭐ |
| **裝備建議** | 無 | 根據雪況推薦裝備 | ⭐⭐⭐⭐ |
| **上下文理解** | 無 | 理解「為什麼」和「怎麼做」 | ⭐⭐⭐⭐⭐ |

### 開發成本

| 項目 | 時間 |
|------|------|
| Dify Workflow 設計 | 3 小時 |
| 前端頁面開發 | 2 天 |
| API 整合 | 1 天 |
| 測試與優化 | 1 天 |
| **總計** | **4-5 天** |

### 月運營成本

- Dify 自部署：$5/月
- Claude API：$10-20/月（預估 500 次調用）
- **總計**：$15-25/月

### ROI 預估

- **用戶滿意度**：+50%（從「推薦課程」到「完整計畫」）
- **行程準備充分度**：+70%（明確知道該做什麼）
- **安全事故率**：-30%（提前警告風險）
- **課程完成率**：+40%（有明確目標）

---

## 2️⃣ Buddy Skill Card（雪伴技能卡片）

### 整合服務
- snowbuddy-matching（媒合資料）
- 單板教學（學習紀錄）
- user-core（用戶歷史）

### 核心概念
```
媒合成功後，一張卡片展示：
「你們的技能互補分析 + 破冰建議」
```

### 使用場景
```
A 和 B 媒合成功
↓
系統自動生成技能卡片：
├── 單板教學: A 後刃強（4.5/5）、換刃弱（2.5/5）
│              B 後刃弱（2.8/5）、換刃強（4.2/5）
├── user-core: A 去過 8 個雪場、B 去過 3 個雪場
├── snowbuddy-matching: 兩人都想去二世谷
↓
AI 生成卡片：
「🤝 技能互補分析
 
 A 可以教 B：
 - 後刃控制技巧（A 擅長）
 - 雪場經驗分享（A 去過更多雪場）
 
 B 可以教 A：
 - 換刃技巧（B 擅長）
 
 破冰話題：
 - 聊聊二世谷的粉雪體驗
 - 分享最喜歡的雪道
 
 第一次見面建議：
 - 先在藍道熱身，互相觀察
 - 下午各自練習弱項，互相指導」
```

### Dify Workflow
```yaml
名稱: 雪伴技能卡片生成器

輸入:
  - user_a_id: 用戶 A
  - user_b_id: 用戶 B
  - match_id: 媒合 ID

節點:
  1. [數據聚合]
     - 查詢兩人學習紀錄（單板教學）
     - 查詢兩人歷史（user-core）
     - 查詢媒合資料（snowbuddy-matching）
  
  2. [LLM 分析]
     - 分析技能互補性
     - 生成破冰話題
     - 推薦第一次見面安排
  
  3. [輸出]
     - 技能雷達圖數據
     - 互補分析文字
     - 破冰建議
     - 行程建議
```

### 前端頁面結構
```tsx
<BuddySkillCard>
  <SkillRadarComparison />  {/* 技能雷達圖對比 */}
  <ComplementaryAnalysis /> {/* 互補分析 */}
  <IceBreakers />           {/* 破冰話題 */}
  <FirstMeetingPlan />      {/* 第一次見面建議 */}
  <ContactButton />         {/* 聯絡按鈕 */}
</BuddySkillCard>
```

---

## 3️⃣ Coach Dayboard（教練日誌板）

### 整合服務
- user-core（學生列表）
- 單板教學（學習紀錄）
- knowledge-engagement（測驗結果）

### 核心概念
```
教練每天看一個儀表板：
「今天要教誰？每個人該練什麼？如何分組？」
```

### 使用場景
```
教練登入 → 看到今天的學生列表
↓
系統自動分析：
├── user-core: 今天有 8 個學生
├── 單板教學: 每個人的練習紀錄
├── knowledge-engagement: 最近測驗結果
↓
AI 生成教練日誌：
「📋 今天的教學計畫（2025-12-06）
 
 學生分組建議：
 
 【初級組】3 人
 - 小明（後刃弱 2.5/5）
 - 小華（換刃弱 2.8/5）
 - 小美（平衡弱 2.3/5）
 
 建議課程：lesson-03「站姿與平衡」
 教學重點：重心控制、膝蓋彎曲
 預計時間：1.5 小時
 
 【中級組】3 人
 - 阿強（想學粉雪）
 - 阿明（想學跳躍）
 - 阿華（想學刻滑）
 
 建議：分開教學（需求差異大）
 
 【進階組】2 人
 - 大雄（準備 CASI Level 2）
 - 靜香（想挑戰黑道）
 
 建議課程：lesson-107「征服黑道」
 教學重點：陡坡控速、心理建設
 
 ⚠️ 特別注意：
 - 小明上次摔倒，今天多關注信心建立
 - 阿強新買裝備，檢查固定器設定」
```

### Dify Workflow
```yaml
名稱: 教練日誌板生成器

輸入:
  - coach_id: 教練 ID
  - date: 日期

節點:
  1. [數據聚合]
     - 查詢今天的學生列表（user-core）
     - 查詢每個學生的練習紀錄（單板教學）
     - 查詢測驗結果（knowledge-engagement）
  
  2. [LLM 分析]
     - 分析學生程度和需求
     - 生成分組建議
     - 推薦教學課程
     - 識別特殊注意事項
  
  3. [輸出]
     - 分組建議
     - 每組教學計畫
     - 個人化注意事項
     - 時間安排
```

### 前端頁面結構
```tsx
<CoachDayboard>
  <DateSelector />          {/* 日期選擇 */}
  <StudentOverview />       {/* 學生總覽 */}
  <GroupingSuggestions />   {/* 分組建議 */}
  <TeachingPlans />         {/* 教學計畫 */}
  <SpecialNotes />          {/* 特別注意 */}
  <QuickActions />          {/* 快速操作 */}
</CoachDayboard>
```

---

## 4️⃣ Gear Readiness（裝備就緒檢查）

### 整合服務
- gear-ops（裝備資訊）
- resort-services（雪場條件）
- user-core（用戶程度）

### 核心概念
```
出發前自動檢查：
「你的裝備適合這次行程嗎？」
```

### 使用場景
```
用戶規劃：二世谷 4 天（粉雪為主）
↓
系統自動檢查：
├── gear-ops: 你有 2 塊板（All-Mountain 板 + Freeride 板）
├── resort-services: 二世谷典型雪況（粉雪 60%、壓雪道 40%）
├── user-core: 你的程度（中級）
↓
AI 建議：
「✅ Freeride 板更適合（寬度 268mm，適合粉雪）
 ⚠️ All-Mountain 板邊刃磨損（建議保養）
 💡 建議攜帶：
    - 主力：Freeride 板（Day 2-4 粉雪）
    - 備用：All-Mountain 板（Day 1 壓雪道熱身）」
```

### Dify Workflow
```yaml
名稱: 裝備行程適配檢查器

輸入:
  - trip_id: 行程 ID
  - user_id: 用戶 ID

節點:
  1. [數據聚合]
     - 查詢行程詳情（resort-services）
     - 查詢用戶裝備（gear-ops）
     - 查詢用戶程度（user-core）
  
  2. [Vision 分析]（可選）
     - 分析裝備照片
     - 檢測磨損程度
  
  3. [LLM 分析]
     - 匹配裝備與雪場條件
     - 生成適配度評分
     - 提供保養建議
  
  4. [輸出]
     - 裝備適配度（每件裝備）
     - 保養建議
     - 打包清單
```

### 前端頁面結構
```tsx
<GearTripChecker>
  <TripSummary />          {/* 行程摘要 */}
  <GearCompatibility />    {/* 裝備適配度 */}
  <MaintenanceAlerts />    {/* 保養提醒 */}
  <PackingList />          {/* 打包清單 */}
  <NearbyShops />          {/* 附近店家 */}
</GearTripChecker>
```

---

### 整合服務
- gear-ops（裝備資訊）
- resort-services（雪場條件）
- user-core（用戶程度）

### 核心概念
```
出發前 3 天自動提醒：
「你的裝備準備好了嗎？需要保養嗎？」
```

### 使用場景
```
用戶規劃：二世谷 4 天（3 天後出發）
↓
系統自動檢查：
├── gear-ops: 你有 2 塊板（All-Mountain 板 + Freeride 板）
│             上次使用：30 天前
│             邊刃狀態：需要打磨
├── resort-services: 二世谷典型雪況（粉雪 60%、壓雪道 40%）
├── user-core: 你的程度（中級）
↓
AI 生成檢查清單：
「🎒 裝備就緒檢查（二世谷行程）
 
 ✅ 雪板選擇：
 - 主力：Freeride 板（寬度 268mm，適合粉雪）
 - 備用：All-Mountain 板（Day 1 壓雪道熱身）
 
 ⚠️ 保養提醒：
 - 邊刃需要打磨（上次使用 30 天前）
 - 建議打蠟（粉雪專用蠟）
 
 📍 附近店家：
 - 板橋滑雪店（距離 2.3km）
 - 營業時間：10:00-20:00
 - 服務：打磨 $300、打蠟 $200
 
 📋 打包清單：
 - 雪板 x2
 - 固定器工具
 - 備用螺絲
 - 護目鏡（建議 2 副，粉雪天氣多變）
 - 防水手套
 
 💡 建議：
 - 明天去保養（還有 2 天）
 - 粉雪板建議提前適應（可以先去小叮噹練習）」
```

### Dify Workflow
```yaml
名稱: 裝備就緒檢查器

輸入:
  - trip_id: 行程 ID
  - user_id: 用戶 ID
  - days_before: 出發前幾天（預設 3）

節點:
  1. [數據聚合]
     - 查詢行程詳情（resort-services）
     - 查詢用戶裝備（gear-ops）
     - 查詢用戶程度（user-core）
  
  2. [Vision 分析]（可選）
     - 分析裝備照片
     - 檢測磨損程度
     - 識別裝備型號
  
  3. [LLM 分析]
     - 匹配裝備與雪場條件
     - 生成保養建議
     - 推薦附近店家
     - 生成打包清單
  
  4. [地理位置查詢]
     - 查詢附近滑雪店
     - 計算距離和營業時間
  
  5. [輸出]
     - 裝備適配度評分
     - 保養建議
     - 店家推薦
     - 打包清單
```

### 前端頁面結構
```tsx
<GearReadiness>
  <TripCountdown />         {/* 出發倒數 */}
  <GearCompatibility />     {/* 裝備適配度 */}
  <MaintenanceAlerts />     {/* 保養提醒 */}
  <NearbyShops />           {/* 附近店家 */}
  <PackingChecklist />      {/* 打包清單 */}
  <PhotoUpload />           {/* 上傳裝備照片 */}
</GearReadiness>
```

---

## 5️⃣ Season Storyboard（雪季故事板）

### 整合服務
- user-core（行為事件）
- 單板教學（學習進度）
- resort-services（雪場目標）
- gear-ops（裝備變化）

### 核心概念
```
雪季結束時自動生成：
「你的雪季故事 + 成長軌跡 + 下季建議」
```

### 使用場景
```
雪季結束（2024-25）
↓
系統自動生成故事板：
├── user-core: 去了 5 個雪場、滑行 15 天、累計 50,000m 垂直落差
├── 單板教學: 完成 12 堂課程、平均評分 3.8/5
├── resort-services: 最愛雪場：白馬（去了 3 次）
├── gear-ops: 換了一塊新板（Burton Custom）
↓
AI 生成故事：
「🎿 你的 2024-25 雪季故事
 
 📊 數據總覽：
 - 滑行天數：15 天
 - 雪場數量：5 個（白馬、二世谷、志賀高原、苗場、輕井澤）
 - 垂直落差：50,000m（相當於爬了 5.5 座玉山！）
 - 最長連滑：3 天（白馬）
 
 🎯 技能成長：
 - 後刃控制：2.5/5 → 4.2/5（+68%）⭐
 - 換刃技巧：3.0/5 → 3.8/5（+27%）
 - 粉雪滑行：0/5 → 2.5/5（新技能解鎖！）🎉
 
 🏔️ 雪場探索：
 - 最愛：白馬（去了 3 次，愛上陡坡挑戰）
 - 最難忘：二世谷粉雪初體驗（雖然摔了 10 次 😅）
 - 最想再去：志賀高原（樹林滑行超刺激）
 
 🎒 裝備升級：
 - 12 月：購入 Burton Custom（終於換新板了！）
 - 效果：速度提升 20%，轉彎更靈活
 
 💡 下季建議：
 - 繼續加強粉雪技巧（目標 4/5）
 - 挑戰更多黑道（目前只征服 3 條）
 - 嘗試公園跳台（新目標！）
 - 推薦雪場：野澤溫泉（樹林多，適合練粉雪）
 
 🎖️ 成就解鎖：
 - 🏆 粉雪新手（完成 5 次粉雪滑行）
 - 🏆 雪場探險家（去過 5 個雪場）
 - 🏆 垂直挑戰者（累計 50,000m）
 - 🏆 裝備達人（擁有 2 塊板）」
```

### Dify Workflow
```yaml
名稱: 雪季故事板生成器

輸入:
  - user_id: 用戶 ID
  - season_id: 雪季 ID（如 2024-25）

節點:
  1. [數據聚合]
     - 查詢滑行紀錄（user-core）
     - 查詢學習進度（單板教學）
     - 查詢雪場歷史（resort-services）
     - 查詢裝備變化（gear-ops）
  
  2. [數據分析]
     - 計算統計數據
     - 識別成長軌跡
     - 找出最愛雪場
     - 檢測裝備變化
  
  3. [LLM 生成]
     - 生成個人化故事
     - 分析技能進步
     - 推薦下季目標
     - 生成激勵訊息
  
  4. [視覺化]
     - 生成成長曲線圖
     - 生成雪場地圖
     - 生成技能雷達圖
  
  5. [輸出]
     - 故事文字
     - 統計數據
     - 視覺化圖表
     - 下季建議
```

### 前端頁面結構
```tsx
<SeasonStoryboard>
  <SeasonHeader />          {/* 雪季標題 */}
  <StatsOverview />         {/* 數據總覽 */}
  <SkillGrowthChart />      {/* 技能成長曲線 */}
  <ResortMap />             {/* 雪場地圖 */}
  <Highlights />            {/* 精彩時刻 */}
  <GearEvolution />         {/* 裝備演進 */}
  <Achievements />          {/* 成就徽章 */}
  <NextSeasonGoals />       {/* 下季目標 */}
  <ShareButton />           {/* 分享按鈕 */}
</SeasonStoryboard>
```

---

## 6️⃣ Pro Growth Console（專業成長控制台）

### 整合服務
- user-core（行為事件）
- 單板教學（學習紀錄）
- knowledge-engagement（測驗結果）
- resort-services（雪場經驗）

### 核心概念
```
給進階玩家的深度分析儀表板：
「數據視覺化 + AI 智能分析 + 改善建議」
```

### 使用場景
```
進階玩家登入 → 看到專業儀表板
↓
系統自動分析：
├── user-core: 滑行數據、行為模式
├── 單板教學: 213 堂課程完成度
├── knowledge-engagement: 測驗成績趨勢
├── resort-services: 雪場挑戰紀錄
↓
AI 生成分析報告：
「📊 專業成長控制台
 
 🎯 整體評估：
 - 綜合程度：進階（8.2/10）
 - 強項：後刃控制、陡坡滑行
 - 弱項：公園跳台、樹林穿梭
 - 成長速度：+15%（過去 3 個月）
 
 📈 技能雷達圖：
 - 站姿與平衡：9/10 ⭐⭐⭐⭐⭐
 - 旋轉：7/10 ⭐⭐⭐⭐
 - 用刃：8/10 ⭐⭐⭐⭐
 - 壓力：6/10 ⭐⭐⭐
 - 時機與協調：7/10 ⭐⭐⭐⭐
 
 🔍 深度分析：
 
 【後刃控制】9/10
 - 優勢：重心穩定、刃角控制精準
 - 數據：過去 10 次練習平均 4.5/5
 - 建議：已達專業水準，可以教學
 
 【公園跳台】3/10
 - 問題：起跳時機不穩、落地姿勢僵硬
 - 數據：完成 2/8 相關課程
 - 建議：先練 lesson-86「跳台直飛入門」
 
 【樹林穿梭】4/10
 - 問題：視線規劃不足、轉彎半徑過大
 - 數據：只去過 1 次樹林區（白馬）
 - 建議：多去野澤溫泉練習
 
 💡 AI 改善建議：
 
 1. 短期目標（1 個月）：
    - 完成公園跳台課程（lesson-86, 87, 88）
    - 去苗場公園練習 3 次
    - 目標：跳台技能 3/10 → 6/10
 
 2. 中期目標（3 個月）：
    - 挑戰更多樹林區（野澤、志賀）
    - 完成樹林課程（lesson-112）
    - 目標：樹林技能 4/10 → 7/10
 
 3. 長期目標（1 年）：
    - 準備 CASI Level 2 認證
    - 五項技能均達 8/10
    - 成為教練
 
 📅 訓練計畫：
 
 本週（12/9-12/15）：
 - 週三：苗場公園（練跳台）
 - 週六：白馬（複習後刃）
 
 下週（12/16-12/22）：
 - 週三：野澤溫泉（樹林練習）
 - 週日：志賀高原（長道練習）
 
 🎖️ 里程碑追蹤：
 - ✅ 完成 100 堂課程（213 堂中）
 - ✅ 去過 10 個雪場
 - 🔲 五項技能均達 8/10（目前 4/5）
 - 🔲 CASI Level 2 認證（預計 2026 年）」
```

### Dify Workflow
```yaml
名稱: 專業成長控制台生成器

輸入:
  - user_id: 用戶 ID

節點:
  1. [數據聚合]
     - 查詢所有滑行數據（user-core）
     - 查詢學習紀錄（單板教學）
     - 查詢測驗結果（knowledge-engagement）
     - 查詢雪場經驗（resort-services）
  
  2. [數據分析]
     - 計算五項技能評分
     - 識別強項和弱項
     - 分析成長趨勢
     - 預測未來進步
  
  3. [LLM 深度分析]
     - 生成技能分析報告
     - 提供改善建議
     - 制定訓練計畫
     - 設定里程碑
  
  4. [視覺化]
     - 生成技能雷達圖
     - 生成成長曲線
     - 生成熱力圖
  
  5. [輸出]
     - 整體評估
     - 深度分析
     - 改善建議
     - 訓練計畫
     - 視覺化圖表
```

### 前端頁面結構
```tsx
<ProGrowthConsole>
  <OverallAssessment />     {/* 整體評估 */}
  <SkillRadarChart />       {/* 技能雷達圖 */}
  <GrowthTrendChart />      {/* 成長趨勢圖 */}
  <DeepAnalysis />          {/* 深度分析 */}
  <ImprovementPlan />       {/* 改善建議 */}
  <TrainingSchedule />      {/* 訓練計畫 */}
  <MilestoneTracker />      {/* 里程碑追蹤 */}
  <ComparisonTool />        {/* 與他人比較 */}
</ProGrowthConsole>
```

---

## 7️⃣ Skill-Based Trip Optimizer（技能導向行程優化器）

### 整合服務
- 單板教學（學習紀錄）
- resort-services（雪場資訊）
- user-core（用戶歷史）

### 核心概念
```
根據想練的技能，推薦最適合的雪場和行程
```

### 使用場景
```
用戶輸入：「我想加強後刃控制」
↓
Dify 分析：
├── 從單板教學讀取：用戶後刃評分 2.5/5（弱項）
├── 從 user-core 讀取：去過的雪場都是短道
├── 從 resort-services 搜尋：有長藍道的雪場
↓
推薦：
「建議去志賀高原（有 5km 長藍道，適合練後刃）
 行程安排：
 - Day 1: 短道熱身 + 複習 lesson-03
 - Day 2-3: 長道練習，專注後刃控制
 - Day 4: 驗收成果
 
 必練課程：
 - lesson-03「後刃控制」
 - lesson-27「後刃開髖護膝」
 - lesson-50「後刃膝頂前刃降立刃」」
```

### Dify Workflow
```yaml
名稱: 技能導向行程優化器

輸入:
  - user_id: 用戶 ID
  - target_skill: 目標技能（如「後刃控制」）

節點:
  1. [數據聚合]
     - 查詢用戶技能評分（單板教學）
     - 查詢用戶歷史（user-core）
     - 搜尋相關課程（單板教學）
  
  2. [雪場匹配]
     - 根據技能需求搜尋雪場（resort-services）
     - 匹配雪道類型和難度
  
  3. [LLM 分析]
     - 生成行程建議
     - 推薦課程
     - 制定訓練計畫
  
  4. [輸出]
     - 推薦雪場（排序）
     - 行程安排
     - 必練課程
```

### 前端頁面結構
```tsx
<SkillBasedTripOptimizer>
  <SkillSelector />        {/* 選擇想練的技能 */}
  <AIAnalysis />           {/* AI 分析結果 */}
  <RecommendedResorts />   {/* 推薦雪場 */}
  <DailyPlan />            {/* 每日計畫 */}
  <RecommendedLessons />   {/* 必練課程 */}
  <CreateTripButton />     {/* 一鍵建立行程 */}
</SkillBasedTripOptimizer>
```

---

## 8️⃣ Post-Trip Learning Report（行程後學習報告）

### 整合服務
- user-core（滑行紀錄）
- 單板教學（學習紀錄）
- resort-services（雪場特色）

### 核心概念
```
行程結束後，自動生成：
「這次去了哪、滑了什麼、學到什麼、下次該練什麼」
```

### 使用場景
```
行程結束：白馬 3 天
↓
系統自動生成報告：
├── user-core: 滑行紀錄（3 天、15 條雪道、藍道 60%、黑道 40%）
├── resort-services: 白馬特色（陡坡多、樹林多）
├── 單板教學: 行程期間的練習紀錄（完成 2 堂課、評分 3.5/5）
↓
AI 生成報告：
「🎿 白馬 3 天總結
 
 滑行成就：
 - 首次挑戰黑道（Happo-One 主道）
 - 完成 15 條雪道，累計 8000m 垂直落差
 
 技能進步：
 - 陡坡控速有改善（lesson-45 評分 4/5）
 - 樹林穿梭還需練習（lesson-67 評分 3/5）
 
 下次建議：
 - 繼續練習樹林技巧（推薦去野澤溫泉）
 - 可以挑戰更陡的黑道（推薦志賀高原）」
```

### Dify Workflow
```yaml
名稱: 行程後學習報告生成器

輸入:
  - trip_id: 行程 ID
  - user_id: 用戶 ID

節點:
  1. [數據聚合]
     - 查詢滑行紀錄（user-core）
     - 查詢學習紀錄（單板教學）
     - 查詢雪場特色（resort-services）
  
  2. [RAG 檢索]
     - 搜尋相關課程
  
  3. [LLM 生成]
     - 生成個人化故事
     - 分析技能進步
     - 推薦下次目標
  
  4. [輸出]
     - 行程總結（故事化）
     - 技能進步分析
     - 下次建議（雪場 + 課程）
```

### 前端頁面結構
```tsx
<PostTripReport>
  <TripSummary />          {/* 行程摘要 */}
  <SkiingStats />          {/* 滑行統計 */}
  <SkillProgress />        {/* 技能進步 */}
  <Highlights />           {/* 精彩時刻 */}
  <NextSteps />            {/* 下次建議 */}
  <ShareButton />          {/* 分享按鈕 */}
</PostTripReport>
```

---

## 4️⃣ Buddy Skill Gap Analyzer（雪伴技能差距分析器）

### 整合服務
- snowbuddy-matching（媒合資料）
- 單板教學（學習紀錄）
- user-core（用戶歷史）

### 核心概念
```
媒合成功後，分析兩人的技能差距：
「你們適合一起練什麼？誰可以教誰？」
```

### 使用場景
```
A 和 B 媒合成功
↓
系統分析：
├── 單板教學: A 後刃強（4.5/5）、換刃弱（2.5/5）
│              B 後刃弱（2.8/5）、換刃強（4.2/5）
├── user-core: A 去過 8 個雪場、B 去過 3 個雪場
├── snowbuddy-matching: 兩人都想去二世谷
↓
AI 建議：
「🤝 技能互補分析
 
 A 可以教 B：
 - 後刃控制技巧（A 擅長）
 - 雪場經驗分享（A 去過更多雪場）
 
 B 可以教 A：
 - 換刃技巧（B 擅長）
 
 一起練習：
 - 二世谷藍道（適合兩人程度）
 - 建議課程：lesson-15（連續轉彎，兩人都需要）
 
 行程安排：
 - 上午：各自練習弱項（A 練換刃、B 練後刃）
 - 下午：一起滑，互相指導」
```

### Dify Workflow
```yaml
名稱: 雪伴技能差距分析器

輸入:
  - user_a_id: 用戶 A
  - user_b_id: 用戶 B

節點:
  1. [數據聚合]
     - 查詢兩人學習紀錄（單板教學）
     - 查詢兩人歷史（user-core）
     - 查詢媒合資料（snowbuddy-matching）
  
  2. [LLM 分析]
     - 分析技能互補性
     - 生成教學建議
     - 推薦共同練習
  
  3. [輸出]
     - 技能對比
     - 互補分析
     - 行程建議
     - 破冰話題
```

### 前端頁面結構
```tsx
<BuddySkillGapAnalyzer>
  <SkillRadarComparison />  {/* 技能雷達圖對比 */}
  <ComplementaryAnalysis /> {/* 互補分析 */}
  <JointTripPlan />         {/* 行程建議 */}
  <IceBreakers />           {/* 破冰話題 */}
</BuddySkillGapAnalyzer>
```

---

## 5️⃣ Season Goal Tracker（雪季目標追蹤器）

### 整合服務
- user-core（行為事件）
- 單板教學（學習進度）
- resort-services（雪場目標）
- gear-ops（裝備目標）

### 核心概念
```
雪季開始時設定目標，全季追蹤進度：
「我想這季完成 10 個雪場、學會 5 個新技能、換一塊新板」
```

### 使用場景
```
雪季目標：
├── 雪場目標：去 10 個新雪場（resort-services）
├── 技能目標：學會粉雪技巧（單板教學）
├── 裝備目標：換一塊 Freeride 板（gear-ops）
├── 社交目標：認識 5 個新雪友（snowbuddy-matching）
↓
全季追蹤：
├── Week 4: 去了白馬（1/10 雪場）✅
├── Week 8: 完成 lesson-67 粉雪入門（技能進度 20%）✅
├── Week 12: 購入 Burton Custom（裝備目標完成）✅
↓
AI 分析：
「🎯 雪季進度報告（Week 12）
 
 雪場目標：1/10（進度慢，建議加快）
 - 推薦：下個月去志賀高原（新雪場 + 適合練粉雪）
 
 技能目標：20%（進度正常）
 - 下一步：lesson-68 粉雪進階
 
 裝備目標：✅ 完成
 - 建議：新板需要磨合，多滑幾次
 
 社交目標：0/5（需加強）
 - 建議：在雪伴公佈欄發布行程」
```

### Dify Workflow
```yaml
名稱: 雪季目標追蹤器

輸入:
  - user_id: 用戶 ID
  - season_id: 雪季 ID

節點:
  1. [數據聚合]
     - 查詢目標設定
     - 查詢各服務進度
  
  2. [進度計算]
     - 計算完成百分比
     - 識別落後項目
  
  3. [LLM 分析]
     - 生成進度報告
     - 提供改善建議
     - 激勵性訊息
  
  4. [輸出]
     - 進度報告
     - 下一步行動
     - 激勵訊息
```

### 前端頁面結構
```tsx
<SeasonGoalTracker>
  <GoalSetting />          {/* 目標設定 */}
  <ProgressDashboard />    {/* 進度儀表板 */}
  <Timeline />             {/* 時間軸 */}
  <AIRecommendations />    {/* AI 建議 */}
  <Milestones />           {/* 里程碑 */}
</SeasonGoalTracker>
```

---

## 📊 開發優先順序

| 服務 | 資料展示 vs AI 增強 | 用戶價值 | 開發成本 | 推薦度 |
|------|-------------------|---------|---------|--------|
| **Trip Prep Lab** | 推薦課程列表 → 完整學習計畫 + 現場建議 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ✅✅✅ |
| **Buddy Skill Card** | 資料展示 → 匹配分析 + 破冰建議 | ⭐⭐⭐⭐ | ⭐⭐ | ✅✅✅ |
| **Coach Dayboard** | 學生列表 → 個人化教案 + 分組建議 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ✅✅✅ |
| **Gear Readiness** | 保養提醒 → 照片分析 + 店家推薦 | ⭐⭐⭐⭐ | ⭐⭐ | ✅✅ |
| **Season Storyboard** | 資料統計 → 個人化故事 + 成長建議 | ⭐⭐⭐ | ⭐⭐⭐⭐ | ✅✅ |
| **Pro Growth Console** | 資料視覺化 → 智能分析 + 改善建議 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ✅✅ |

---

## 🎯 實作建議

### Phase 1（立即，1-2 週）

**優先開發**：
1. **Trip Prep Lab**（最高 ROI）
   - 時間：5 天
   - 理由：直接解決「不知道該練什麼」痛點
   - Dify 價值：從推薦列表 → 完整行前計畫

2. **Buddy Skill Card**（快速上線）
   - 時間：3 天
   - 理由：提升媒合成功率
   - Dify 價值：從資料展示 → 智能匹配分析

### Phase 2（1 個月後，2-3 週）

**深化功能**：
3. **Coach Dayboard**（教練工具）
   - 時間：5 天
   - 理由：提升教練效率
   - Dify 價值：從學生列表 → 個人化教案

4. **Gear Readiness**（差異化功能）
   - 時間：4 天
   - 理由：獨特的裝備檢查功能
   - Dify 價值：Vision Agent 分析照片

### Phase 3（3 個月後，3-4 週）

**長期價值**：
5. **Season Storyboard**（用戶黏性）
   - 時間：1 週
   - 理由：提升用戶留存
   - Dify 價值：從數據統計 → 個人化故事

6. **Pro Growth Console**（進階玩家）
   - 時間：2 週
   - 理由：服務高價值用戶
   - Dify 價值：從視覺化 → 深度智能分析

---

## 💰 成本與效益總覽

### 開發成本

| Phase | 服務數量 | 時間 | 人力 |
|-------|---------|------|------|
| Phase 1 | 2 個 | 1-2 週 | 1 人 |
| Phase 2 | 2 個 | 2-3 週 | 1 人 |
| Phase 3 | 2 個 | 3-4 週 | 1 人 |
| **總計** | **6 個** | **6-9 週** | **1 人** |

### 月運營成本

| 項目 | 成本 | 說明 |
|------|------|------|
| Dify 自部署（Zeabur） | $5/月 | 日本節點 |
| Claude API（1000 用戶） | $50-100/月 | Haiku + Sonnet |
| GPT-4V（Vision 功能） | $30-50/月 | 裝備照片分析 |
| **總計** | **$85-155/月** | 視使用量 |

### ROI 預估

| 指標 | 改善 | 說明 |
|------|------|------|
| 用戶滿意度 | +50% | 從資料展示 → 智能建議 |
| Engagement | +60% | AI 生成內容更吸引人 |
| 媒合成功率 | +40% | Buddy Skill Card 提升匹配度 |
| 教練效率 | +30% | Coach Dayboard 自動分組 |
| 用戶留存 | +35% | Season Storyboard 提升黏性 |

**投入**: 6-9 週開發 + $85-155/月  
**產出**: 用戶體驗大幅提升 + 6 個差異化功能  
**結論**: **非常值得投資** 🚀

---

## 📋 開發檢查清單

### Phase 1（Week 1-2）
- [ ] Trip Prep Lab
  - [ ] Dify Workflow 設計
  - [ ] 前端頁面開發
  - [ ] API 整合
  - [ ] 測試與優化
- [ ] Buddy Skill Card
  - [ ] Dify Workflow 設計
  - [ ] 技能雷達圖組件
  - [ ] 破冰建議生成
  - [ ] 測試與優化

### Phase 2（Week 3-5）
- [ ] Coach Dayboard
  - [ ] Dify Workflow 設計
  - [ ] 分組算法優化
  - [ ] 教案生成
  - [ ] 測試與優化
- [ ] Gear Readiness
  - [ ] Vision Agent 設置
  - [ ] 照片上傳功能
  - [ ] 店家地圖整合
  - [ ] 測試與優化

### Phase 3（Week 6-9）
- [ ] Season Storyboard
  - [ ] 數據聚合邏輯
  - [ ] 故事生成 Workflow
  - [ ] 視覺化圖表
  - [ ] 分享功能
- [ ] Pro Growth Console
  - [ ] 深度分析算法
  - [ ] 技能評分系統
  - [ ] 訓練計畫生成
  - [ ] 里程碑追蹤

---

## 7️⃣ Skill-Based Trip Optimizer（技能導向行程優化器）

### 整合服務
- 單板教學（學習紀錄）
- resort-services（雪場資訊）
- user-core（用戶歷史）

### 核心概念
```
根據想練的技能，推薦最適合的雪場和行程
```

### 使用場景
```
用戶輸入：「我想加強後刃控制」
↓
Dify 分析：
├── 從單板教學讀取：用戶後刃評分 2.5/5（弱項）
├── 從 user-core 讀取：去過的雪場都是短道
├── 從 resort-services 搜尋：有長藍道的雪場
↓
推薦：
「建議去志賀高原（有 5km 長藍道，適合練後刃）
 行程安排：
 - Day 1: 短道熱身 + 複習 lesson-03
 - Day 2-3: 長道練習，專注後刃控制
 - Day 4: 驗收成果
 
 必練課程：
 - lesson-03「後刃控制」
 - lesson-27「後刃開髖護膝」
 - lesson-50「後刃膝頂前刃降立刃」」
```

### Dify Workflow
```yaml
名稱: 技能導向行程優化器

輸入:
  - user_id: 用戶 ID
  - target_skill: 目標技能（如「後刃控制」）

節點:
  1. [數據聚合]
     - 查詢用戶技能評分（單板教學）
     - 查詢用戶歷史（user-core）
     - 搜尋相關課程（單板教學）
  
  2. [雪場匹配]
     - 根據技能需求搜尋雪場（resort-services）
     - 匹配雪道類型和難度
  
  3. [LLM 分析]
     - 生成行程建議
     - 推薦課程
     - 制定訓練計畫
  
  4. [輸出]
     - 推薦雪場（排序）
     - 行程安排
     - 必練課程
```

### 前端頁面結構
```tsx
<SkillBasedTripOptimizer>
  <SkillSelector />        {/* 選擇想練的技能 */}
  <AIAnalysis />           {/* AI 分析結果 */}
  <RecommendedResorts />   {/* 推薦雪場 */}
  <DailyPlan />            {/* 每日計畫 */}
  <RecommendedLessons />   {/* 必練課程 */}
  <CreateTripButton />     {/* 一鍵建立行程 */}
</SkillBasedTripOptimizer>
```

---

## 8️⃣ Post-Trip Learning Report（行程後學習報告）

### 整合服務
- user-core（滑行紀錄）
- 單板教學（學習紀錄）
- resort-services（雪場特色）

### 核心概念
```
行程結束後，自動生成：
「這次去了哪、滑了什麼、學到什麼、下次該練什麼」
```

### 使用場景
```
行程結束：白馬 3 天
↓
系統自動生成報告：
├── user-core: 滑行紀錄（3 天、15 條雪道、藍道 60%、黑道 40%）
├── resort-services: 白馬特色（陡坡多、樹林多）
├── 單板教學: 行程期間的練習紀錄（完成 2 堂課、評分 3.5/5）
↓
AI 生成報告：
「🎿 白馬 3 天總結
 
 滑行成就：
 - 首次挑戰黑道（Happo-One 主道）
 - 完成 15 條雪道，累計 8000m 垂直落差
 
 技能進步：
 - 陡坡控速有改善（lesson-45 評分 4/5）
 - 樹林穿梭還需練習（lesson-67 評分 3/5）
 
 下次建議：
 - 繼續練習樹林技巧（推薦去野澤溫泉）
 - 可以挑戰更陡的黑道（推薦志賀高原）」
```

### Dify Workflow
```yaml
名稱: 行程後學習報告生成器

輸入:
  - trip_id: 行程 ID
  - user_id: 用戶 ID

節點:
  1. [數據聚合]
     - 查詢滑行紀錄（user-core）
     - 查詢學習紀錄（單板教學）
     - 查詢雪場特色（resort-services）
  
  2. [RAG 檢索]
     - 搜尋相關課程
  
  3. [LLM 生成]
     - 生成個人化故事
     - 分析技能進步
     - 推薦下次目標
  
  4. [輸出]
     - 行程總結（故事化）
     - 技能進步分析
     - 下次建議（雪場 + 課程）
```

### 前端頁面結構
```tsx
<PostTripReport>
  <TripSummary />          {/* 行程摘要 */}
  <SkiingStats />          {/* 滑行統計 */}
  <SkillProgress />        {/* 技能進步 */}
  <Highlights />           {/* 精彩時刻 */}
  <NextSteps />            {/* 下次建議 */}
  <ShareButton />          {/* 分享按鈕 */}
</PostTripReport>
```

---

## 9️⃣ Gear-Trip Compatibility Checker（裝備行程適配檢查器）

### 整合服務
- gear-ops（裝備資訊）
- resort-services（雪場條件）
- user-core（用戶程度）

### 核心概念
```
出發前自動檢查：「你的裝備適合這次行程嗎？」
```

### 使用場景
```
用戶規劃：二世谷 4 天（粉雪為主）
↓
系統自動檢查：
├── gear-ops: 你有 2 塊板（All-Mountain 板 + Freeride 板）
├── resort-services: 二世谷典型雪況（粉雪 60%、壓雪道 40%）
├── user-core: 你的程度（中級）
↓
AI 建議：
「✅ Freeride 板更適合（寬度 268mm，適合粉雪）
 ⚠️ All-Mountain 板邊刃磨損（建議保養）
 💡 建議攜帶：
    - 主力：Freeride 板（Day 2-4 粉雪）
    - 備用：All-Mountain 板（Day 1 壓雪道熱身）」
```

### Dify Workflow
```yaml
名稱: 裝備行程適配檢查器

輸入:
  - trip_id: 行程 ID
  - user_id: 用戶 ID

節點:
  1. [數據聚合]
     - 查詢行程詳情（resort-services）
     - 查詢用戶裝備（gear-ops）
     - 查詢用戶程度（user-core）
  
  2. [Vision 分析]（可選）
     - 分析裝備照片
     - 檢測磨損程度
  
  3. [LLM 分析]
     - 匹配裝備與雪場條件
     - 生成適配度評分
     - 提供保養建議
  
  4. [輸出]
     - 裝備適配度（每件裝備）
     - 保養建議
     - 打包清單
```

### 前端頁面結構
```tsx
<GearTripChecker>
  <TripSummary />          {/* 行程摘要 */}
  <GearCompatibility />    {/* 裝備適配度 */}
  <MaintenanceAlerts />    {/* 保養提醒 */}
  <PackingList />          {/* 打包清單 */}
  <NearbyShops />          {/* 附近店家 */}
</GearTripChecker>
```

---

## 🔟 Season Goal Tracker（雪季目標追蹤器）

### 整合服務
- user-core（行為事件）
- 單板教學（學習進度）
- resort-services（雪場目標）
- gear-ops（裝備目標）

### 核心概念
```
雪季開始時設定目標，全季追蹤進度：
「我想這季完成 10 個雪場、學會 5 個新技能、換一塊新板」
```

### 使用場景
```
雪季目標：
├── 雪場目標：去 10 個新雪場（resort-services）
├── 技能目標：學會粉雪技巧（單板教學）
├── 裝備目標：換一塊 Freeride 板（gear-ops）
├── 社交目標：認識 5 個新雪友（snowbuddy-matching）
↓
全季追蹤：
├── Week 4: 去了白馬（1/10 雪場）✅
├── Week 8: 完成 lesson-67 粉雪入門（技能進度 20%）✅
├── Week 12: 購入 Burton Custom（裝備目標完成）✅
↓
AI 分析：
「🎯 雪季進度報告（Week 12）
 
 雪場目標：1/10（進度慢，建議加快）
 - 推薦：下個月去志賀高原（新雪場 + 適合練粉雪）
 
 技能目標：20%（進度正常）
 - 下一步：lesson-68 粉雪進階
 
 裝備目標：✅ 完成
 - 建議：新板需要磨合，多滑幾次
 
 社交目標：0/5（需加強）
 - 建議：在雪伴公佈欄發布行程」
```

### Dify Workflow
```yaml
名稱: 雪季目標追蹤器

輸入:
  - user_id: 用戶 ID
  - season_id: 雪季 ID

節點:
  1. [數據聚合]
     - 查詢目標設定
     - 查詢各服務進度
  
  2. [進度計算]
     - 計算完成百分比
     - 識別落後項目
  
  3. [LLM 分析]
     - 生成進度報告
     - 提供改善建議
     - 激勵性訊息
  
  4. [輸出]
     - 進度報告
     - 下一步行動
     - 激勵訊息
```

### 前端頁面結構
```tsx
<SeasonGoalTracker>
  <GoalSetting />          {/* 目標設定 */}
  <ProgressDashboard />    {/* 進度儀表板 */}
  <Timeline />             {/* 時間軸 */}
  <AIRecommendations />    {/* AI 建議 */}
  <Milestones />           {/* 里程碑 */}
</SeasonGoalTracker>
```

---

## 1️⃣1️⃣ Buddy Skill Gap Analyzer（雪伴技能差距分析器）

### 整合服務
- snowbuddy-matching（媒合資料）
- 單板教學（學習紀錄）
- user-core（用戶歷史）

### 核心概念
```
媒合成功後，分析兩人的技能差距：
「你們適合一起練什麼？誰可以教誰？」
```

### 使用場景
```
A 和 B 媒合成功
↓
系統分析：
├── 單板教學: A 後刃強（4.5/5）、換刃弱（2.5/5）
│              B 後刃弱（2.8/5）、換刃強（4.2/5）
├── user-core: A 去過 8 個雪場、B 去過 3 個雪場
├── snowbuddy-matching: 兩人都想去二世谷
↓
AI 建議：
「🤝 技能互補分析
 
 A 可以教 B：
 - 後刃控制技巧（A 擅長）
 - 雪場經驗分享（A 去過更多雪場）
 
 B 可以教 A：
 - 換刃技巧（B 擅長）
 
 一起練習：
 - 二世谷藍道（適合兩人程度）
 - 建議課程：lesson-15（連續轉彎，兩人都需要）
 
 行程安排：
 - 上午：各自練習弱項（A 練換刃、B 練後刃）
 - 下午：一起滑，互相指導」
```

### Dify Workflow
```yaml
名稱: 雪伴技能差距分析器

輸入:
  - user_a_id: 用戶 A
  - user_b_id: 用戶 B

節點:
  1. [數據聚合]
     - 查詢兩人學習紀錄（單板教學）
     - 查詢兩人歷史（user-core）
     - 查詢媒合資料（snowbuddy-matching）
  
  2. [LLM 分析]
     - 分析技能互補性
     - 生成教學建議
     - 推薦共同練習
  
  3. [輸出]
     - 技能對比
     - 互補分析
     - 行程建議
     - 破冰話題
```

### 前端頁面結構
```tsx
<BuddySkillGapAnalyzer>
  <SkillRadarComparison />  {/* 技能雷達圖對比 */}
  <ComplementaryAnalysis /> {/* 互補分析 */}
  <JointTripPlan />         {/* 行程建議 */}
  <IceBreakers />           {/* 破冰話題 */}
</BuddySkillGapAnalyzer>
```

---

## 🎯 成功指標

### Phase 1 成功標準
- ✅ Trip Prep Lab 使用率 > 60%
- ✅ Buddy Skill Card 媒合成功率 +30%
- ✅ 用戶滿意度 +40%

### Phase 2 成功標準
- ✅ Coach Dayboard 教練採用率 > 70%
- ✅ Gear Readiness Vision 識別準確度 > 85%
- ✅ 裝備保養提醒響應率 > 50%

### Phase 3 成功標準
- ✅ Season Storyboard 分享率 > 40%
- ✅ Pro Growth Console 進階用戶使用率 > 80%
- ✅ 整體用戶留存率 +35%

---

## 📊 開發優先順序

---

**文檔版本**: v1.0  
**最後更新**: 2025-12-06
