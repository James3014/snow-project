功能: 統一滑雪者身份 - 使用者主檔管理
  作為營運人員
  我想要建立、更新、查詢與停用單一 User ID 主檔
  以便其他專案能可靠地引用主檔

  背景:
    假設 user-core 服務已啟動

  # US1 - 驗收情境 1
  場景: 以完整資料建立新使用者主檔
    假設 一筆包含所有必填欄位的新使用者主檔 payload
    當 我建立使用者主檔
    那麼 系統會產生唯一的 User ID
    並且 所有基本欄位被正確儲存
    並且 其他專案能立即查詢到此主檔

  # US1 - 驗收情境 2
  場景: 為既有使用者新增教練角色並發布變更事件
    假設 一位已存在且為啟用狀態的使用者
    且 該使用者目前不含教練角色
    當 我將其角色更新為包含教練
    那麼 系統會記錄此次更新時間
    並且 發布一則變更事件供訂閱者接收

  # 覆蓋 FR-001、FR-006、FR-008
  場景: 停用使用者主檔並留存審計軌跡
    假設 一個目前為啟用狀態的使用者主檔
    且 呼叫端提供 `X-Actor-Id` 標頭
    當 我將此主檔停用
    那麼 主檔狀態應變更為 inactive
    並且 發布的變更事件包含審計摘要（actor、diff、recorded_at）

  # 邊界情況: 防止重複主檔
  場景: 外部匯入造成主檔重複時予以阻擋
    假設 一筆外部匯入 payload 含有已存在的身分識別鍵
    當 我嘗試建立另一個主檔
    那麼 請求應因重複身分而被拒絕
    並且 回應應建議進行合併流程

  # FR-007 - 合併流程
  場景: 合併重複主檔並發布差異
    假設 兩筆主檔擁有不同的角色與 legacy_ids
    且 我透過 `/users/{id}/merge` 指定要被合併的 duplicate_user_id
    當 合併成功
    那麼 主要主檔應保留合併後的角色與 legacy_ids
    並且 被合併主檔狀態變為 merged
    並且 變更事件 payload 含有欄位差異與操作人員資訊
